# GRASP Exercise Format – Technical Specification

**Project**: GRASP
*Guided Reasoning Assistant for Statistics Practice*

**Purpose**:
Define a machine- and human-readable structure for tutoring exercises in statistics. Exercises will be authored by instructors via YAML or generated by LLMs via structured output. The format supports structured progression, visual elements, and feedback scaffolding.

---

## 1. Data Model Overview

Each **Exercise** is structured into one or more **Checkpoints**.
Each **Checkpoint** contains:

- A main question
- Its answer
- An optional solution image
- Multiple sequential **Steps** (aka guiding questions), each with:
  - a question
  - an answer
  - an optional image

---

## 2. Pydantic Models

```python
from pydantic import BaseModel, Field, HttpUrl
from typing import List, Optional
from datetime import date

class Step(BaseModel):
    step_number: int = Field(..., ge=1, description="Strictly sequential step number starting from 1")
    guiding_question: str = Field(..., description="A Markdown-formatted question, optionally with LaTeX math")
    guiding_answer: str = Field(..., description="Markdown-formatted answer, optionally with LaTeX")
    image: Optional[str] = Field(None, description="Relative path or URL to an image for this step")

class Checkpoint(BaseModel):
    checkpoint_number: int = Field(..., ge=1, description="Sequential checkpoint number starting from 1")
    main_question: str = Field(..., description="The primary problem posed at this checkpoint")
    main_answer: str = Field(..., description="The answer or solution summary for the main question")
    image_solution: Optional[str] = Field(None, description="Optional image illustrating the final solution")
    steps: List[Step] = Field(..., description="Ordered guiding questions and their answers")

class ExerciseMetadata(BaseModel):
    title: str = Field(..., description="Name of the exercise")
    topic: str = Field(..., description="Topic area, e.g., ANOVA, Regression")
    level: str = Field(..., description="Intended difficulty level (e.g., beginner, advanced)")
    language: str = Field(..., description="Exercise language (e.g., 'de', 'en')")
    author: Optional[str] = Field(None, description="Author of the exercise")
    tags: Optional[List[str]] = Field(default_factory=list, description="Keywords for filtering/search")
    version: Optional[str] = Field("1.0", description="Format or content version")
    date_created: Optional[date] = Field(None, description="Optional creation date")

class Exercise(BaseModel):
    metadata: ExerciseMetadata
    first_message: str = Field(..., description="Tutor's opening message to the student")
    end_message: str = Field(..., description="Final message shown after the last checkpoint")
    checkpoints: List[Checkpoint] = Field(..., description="Sequential learning checkpoints")
```

---

## 3. Example YAML Exercise

```yaml
metadata:
  title: "Einführung in die Varianzanalyse"
  topic: "ANOVA"
  level: "beginner"
  language: "de"
  author: "Andrew Ellis"
  tags: ["ANOVA", "F-Test", "Koffein", "Müdigkeit"]
  version: "1.0"
  date_created: 2025-05-13

first_message: >
  Ich helfe dir heute das Prinzip der Varianzanalyse (ANOVA) zu verstehen...

end_message: >
  Gute Arbeit! Du hast die Aufgabe beendet. Danke für deinen tollen Einsatz!

checkpoints:
  - checkpoint_number: 1
    main_question: >
      Dieses Bild zeigt die Konzentrationswerte in Abhängigkeit von Koffeinkonsum...
    main_answer: >
      Beobachtungen:
      - der Mittelwert steigt mit Koffeinkonsum leicht an...
      **kein signifikanter Effekt feststellbar.**
    image_solution: "static/Question_1_summary.png"
    steps:
      - step_number: 1
        guiding_question: "Wie kann ich in Zahlen feststellen, wie stark Koffein Konzentration beeinflusst?"
        guiding_answer: "Der Mittelwert einer Gruppe schätzt den Erwartungswert..."
        image: "static/Question_1_Step_0.png"
      - step_number: 2
        guiding_question: >
          Wie stark ist die gesamte Abweichung der Messwerte vom Erwartungswert?
        guiding_answer: >
          **Die Quadratsumme zeigt die gesamte quadratische Abweichung...**
        image: "static/Question_1_Step_1.png"
  - checkpoint_number: 2
    main_question: "Welchen Effekt haben Koffein und Müdigkeit gemeinsam?"
    main_answer: "**Müdigkeit hat einen deutlichen Haupteffekt...**"
    image_solution: null
    steps:
      - step_number: 1
        guiding_question: "Für wieviele und welche Gruppen sollten nun Mittelwert und MQS bestimmt werden?"
        guiding_answer: "Vier Gruppen: (Ja,Ja), (Ja,Nein), (Nein,Ja), (Nein,Nein)"
        image: "static/Question_2_Step_0.png"
```

---

## 4. Using This with OpenAI Structured Output

You can use `Exercise` directly as a `text_format` schema:

```python
from openai import OpenAI
from models import Exercise

client = OpenAI()

response = client.responses.parse(
    model="gpt-4.1",
    input=[{"role": "user", "content": "Generate an ANOVA exercise..." }],
    text_format=Exercise
)

exercise = response.output_parsed
```

---

## 5. Authoring Guidelines

- All text fields can contain **Markdown and LaTeX** (`$...$`).
- All steps must be **sequentially numbered** (starting from 1).
- Images are **optional**, but encouraged for visual support.
- Each checkpoint should have **at least one guiding step**.
- The metadata block should be present in all files.

---

## Summary of Key Features

| Feature               | Supported |
|----------------------|-----------|
| YAML + JSON I/O      | ✅        |
| Human and AI authored| ✅        |
| Markdown + Math      | ✅        |
| Image support        | ✅ (optional) |
| Metadata extensibility | ✅      |
| Strict validation    | ✅ via Pydantic |
